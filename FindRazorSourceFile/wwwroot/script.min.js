const c={openInVSCode:!1},nt="razorsource:options",l="NotFound",f="none",a="./_content/FindRazorSourceFile/",b="findrazorsourcefile-ui",h=document;let tt=!1,n,e=null,u=null,t=null;const k={};let i=0;const s=(n,t)=>{for(let i in t)n.addEventListener(i,t[i])},v=(n,t)=>{for(let i in t)n.removeEventListener(i,t[i])},o=n=>n.stopPropagation(),y=(n,t)=>Object.assign(n.style,t),r=(n,t,i,r)=>{let u={};const f=h.createElement(n);t&&y(f,t);i&&Object.assign(f,i);const e=([n,t])=>(f.appendChild(n),u={...u,...t},n);return r?.forEach(n=>{if(Array.isArray(n))e(n);else for(let t in n){const i=e(n[t]);u[t]=i}}),[f,u]};export const init=()=>{if(!tt){tt=!0;customElements.define(b,ht);const n=()=>{if(!document.body.querySelector(b)){const[n]=r(b);h.body.appendChild(n)}};Blazor.addEventListener("enhancedload",n);n();s(h,{keydown:lt});s(window,{resize:bt,storage:kt})}};class ht extends HTMLElement{constructor(){super()}connectedCallback(){const i=this.attachShadow({mode:"open"}),t=ct(i);n=t;p(1);s(t.overlay,{mousemove:it,click:d});s(t.sourceNameTip,{mousemove:o,click:rt});s(t.settingsButton,{click:ut});s(t.settingsForm,{click:o});s(t.settingsOpenInVSCode,{click:ft});st();this.dispose=()=>{v(t.overlay,{mousemove:it,click:d}),v(t.sourceNameTip,{mousemove:o,click:rt}),v(t.settingsButton,{click:ut}),v(t.settingsForm,{click:o}),v(t.settingsOpenInVSCode,{click:ft})}}disconnectedCallback(){this.dispose?.()}}const ct=n=>{const[t,i]=r("div",{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",zIndex:"9999",backgroundColor:"transparent",borderStyle:"solid",display:f,opacity:"0",transition:"border 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.2s linear"},null,[{sourceNameTip:r("div",{position:"absolute",top:"4px",left:"4px",padding:"2px 6px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",backgroundColor:"#ffc107",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",whiteSpace:"nowrap",display:f,transition:"opacity 0.2s ease-out"},null,[r("img",{verticalAlign:"middle",width:"16px"},{src:a+"ASPWebApplication_16x.svg"}),{sourceNameTipProjectName:r("span",{verticalAlign:"middle",marginLeft:"4px"})},r("span",{verticalAlign:"middle"},{textContent:" | "}),r("img",{verticalAlign:"middle",width:"16px"},{src:a+"ASPRazorFile_16x.svg"}),{sourceNameTipItemName:r("span",{verticalAlign:"middle",marginLeft:"4px"})}])},{settingsButton:r("button",{position:"fixed",bottom:"8px",right:"8px",height:"32px",paddingLeft:"30px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",border:f,backgroundColor:"#fff",borderRadius:"64px",outline:f,backgroundImage:`url('${a}settings_black_24dp.svg')`,backgroundRepeat:"no-repeat",backgroundPosition:"5px center"},{title:"Find Razor Source File - Settings",textContent:"Find Razor Source File"})},{settingsForm:r("div",{position:"fixed",bottom:"0",right:"8px",padding:"8px 12px",border:"#ccc",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",opacity:"0",transition:"ease-out all 0.2s",pointerEvents:f},null,[r("label",{margin:"0",padding:"0",fontFamily:"sans-serif",fontSize:"12px",color:"#111"},null,[{settingsOpenInVSCode:r("input",{margin:"0 8px 0 0",padding:"0",verticalAlign:"middle"},{type:"checkbox"})},r("span",{verticalAlign:"middle"},{textContent:"Open the .razor file of the clicked component in "}),r("img",{verticalAlign:"middle",width:"18px"},{src:a+"vscode.svg"}),r("span",{verticalAlign:"middle"},{textContent:" VSCode"}),])])}]);return n.appendChild(t),{...{overlay:t},...i}},p=t=>{const i=t===1?.3:.5,r=t===1?"0.8":"1.0";y(n.overlay,{borderColor:`rgba(0, 0, 0, ${i})`,boxShadow:`inset rgb(0, 0, 0, ${i}) 0px 0px 6px 4px`});n.sourceNameTip.style.opacity=r},lt=r=>{const e=r.code==="KeyF"&&r.ctrlKey&&r.shiftKey&&!r.metaKey&&!r.altKey,s=r.code==="Escape"&&!r.ctrlKey&&!r.shiftKey&&!r.metaKey&&!r.altKey;i===0&&e?(o(r),r.preventDefault(),i=1,y(n.overlay,{borderWidth:"50vh 50vw",display:"block"}),w(),setTimeout(()=>{(i===1||i===2)&&(n.overlay.style.opacity="1")},1),n.sourceNameTipProjectName.textContent="",n.sourceNameTipItemName.textContent="",u=null,t=null):(i===1||i===2)&&(s||e)&&(o(r),r.preventDefault(),i=e?0:i===2?1:0,p(1),n.sourceNameTip.style.display=f,n.overlay.style.borderWidth="50vh 50vw",w(),i===0&&(n.overlay.style.opacity="0",setTimeout(()=>{i===0&&(n.overlay.style.display=f)},200)))},it=async n=>{i===1&&et(n)},d=n=>{if(w(),i===1){if(u!==null&&e!==null&&e!==l){i=2;p(2);const n=new Event("razorsource:lockin",{bubbles:!1,cancelable:!1});n.razorSourceName=e;h.dispatchEvent(n);c.openInVSCode&&(window.location.href=`vscode://file/${e.fullPath}`)}}else i===2&&(i=1,p(1),et(n))},rt=n=>{o(n),i===1&&d(n)},ut=n=>{o(n),vt()?at():w()},at=()=>Object.assign(n.settingsForm.style,{opacity:"1",bottom:"48px",pointerEvents:"unset"}),w=()=>Object.assign(n.settingsForm.style,{opacity:"0",bottom:"0",pointerEvents:f}),vt=()=>n.settingsForm.style.opacity==="0",ft=t=>{o(t),c.openInVSCode=n.settingsOpenInVSCode.checked,dt()},et=async n=>{const t=yt(n);t.scopeHasChanged!==!1&&(e=await wt(t.scope),ot(t.scopeRect,e))},yt=i=>{n.overlay.style.visibility="hidden";const s=h.elementFromPoint(i.clientX,i.clientY);n.overlay.style.visibility="visible";let r=null;for(var e=s;e!==null;e=e.parentElement)if(r=pt(e),r!==null)break;let f=null;if(r===null){if(t!==null&&t.left<i.clientX&&i.clientX<t.right&&t.top<i.clientY&&i.clientY<t.bottom)return{scope:u,scopeRect:t,scopeHasChanged:!1}}else if(u!==null&&u!==r&&t!==null&&t.left<i.clientX&&i.clientX<t.right&&t.top<i.clientY&&i.clientY<t.bottom&&(f=g(r),f.left<t.left&&f.right>t.right&&f.top<t.top&&f.bottom>t.bottom))return{scope:u,scopeRect:t,scopeHasChanged:!1};const o=u!==r;return o&&(u=r,t=r==null?null:f!==null?f:g(r)),{scope:u,scopeRect:t,scopeHasChanged:o}},pt=n=>n.getAttributeNames().filter(n=>n.startsWith("b-"))[0]||null,wt=async n=>{if(n===null)return null;let t=k[n]||null;if(t!==null)return t;const i=await fetch(`${a}RazorSourceMapFiles/${n}.txt`);if(i.ok){const u=await i.text(),t=u.replace(/[\r\n]*$/ig,"").split("|"),r={projectName:t[0],itemName:t[1],fullPath:t[2]};return k[n]=r,r}return k[n]=l,l},ot=(t,i)=>{if(t===null||i===null||i===l){n.sourceNameTip.style.display=f;n.overlay.style.borderWidth="50vh 50vw";return}const r=n.overlay.getBoundingClientRect();y(n.overlay,{borderStyle:"solid",borderTopWidth:t.top+"px",borderLeftWidth:t.left+"px",borderBottomWidth:r.height-t.bottom+"px",borderRightWidth:r.width-t.right+"px"});n.sourceNameTipProjectName.textContent=i.projectName;n.sourceNameTipItemName.textContent=i.itemName;n.sourceNameTip.style.display="block"},g=n=>{const t={top:9999999,left:9999999,bottom:0,right:0};if(n!==null){const i=h.body.querySelectorAll(`*[${n}]`);i.forEach(n=>{const i=n.getBoundingClientRect();t.top=Math.min(t.top,i.top);t.left=Math.min(t.left,i.left);t.bottom=Math.max(t.bottom,i.bottom);t.right=Math.max(t.right,i.right)})}return t},bt=()=>{i!==0&&u!==null&&t!==null&&e!==null&&e!==l&&(t=g(u),ot(t,e))},kt=()=>st(),dt=()=>{const n=JSON.stringify(c);localStorage.setItem(nt,n)},st=()=>{const t=localStorage.getItem(nt);Object.assign(c,JSON.parse(t||"{}"));n.settingsOpenInVSCode.checked=c.openInVSCode};