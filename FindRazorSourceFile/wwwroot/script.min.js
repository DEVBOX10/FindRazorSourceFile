const h="NotFound";let n,f=null,u=null,t=null;const p={};let i=0;const c={openInVSCode:!1},b="razorsource:options",l="./_content/FindRazorSourceFile/",s=document,e=(n,t)=>{for(let i in t)n.addEventListener(i,t[i])},o=n=>n.stopPropagation(),a=(n,t)=>Object.assign(n.style,t),r=(n,t,i,r)=>{let u={};const f=s.createElement(n);t&&a(f,t);i&&Object.assign(f,i);const e=([n,t])=>(f.appendChild(n),u={...u,...t},n);return r?.forEach(n=>{if(Array.isArray(n))e(n);else for(let t in n){const i=e(n[t]);u[t]=i}}),[f,u]};export const init=()=>{customElements.define("findrazorsourcefile-ui",tt);const[n]=r("findrazorsourcefile-ui");s.body.appendChild(n)};class tt extends HTMLElement{constructor(){super()}connectedCallback(){const t=this.attachShadow({mode:"open"});n=it(t);v(1);e(n.overlay,{mousemove:n=>ut(n),click:n=>k(n)});e(n.sourceNameTip,{mousemove:o,click:n=>ft(n)});e(n.settingsButton,{click:n=>et(n)});e(n.settingsForm,{click:o});e(n.settingsOpenInVSCode,{click:n=>ht(n)});e(s,{keydown:n=>rt(n)});e(window,{resize:n=>vt(n),storage:n=>yt(n)});nt()}}const it=n=>{const[t,i]=r("div",{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",zIndex:"9999",backgroundColor:"transparent",borderStyle:"solid",display:"none",opacity:"0",transition:"border 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.2s linear"},null,[{sourceNameTip:r("div",{position:"absolute",top:"4px",left:"4px",padding:"2px 6px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",backgroundColor:"#ffc107",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",whiteSpace:"nowrap",display:"none",transition:"opacity 0.2s ease-out"},null,[r("img",{verticalAlign:"middle",width:"16px"},{src:l+"ASPWebApplication_16x.svg"}),{sourceNameTipProjectName:r("span",{verticalAlign:"middle",marginLeft:"4px"})},r("span",{verticalAlign:"middle"},{textContent:" | "}),r("img",{verticalAlign:"middle",width:"16px"},{src:l+"ASPRazorFile_16x.svg"}),{sourceNameTipItemName:r("span",{verticalAlign:"middle",marginLeft:"4px"})}])},{settingsButton:r("button",{position:"fixed",bottom:"8px",right:"8px",height:"32px",paddingLeft:"30px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",border:"none",backgroundColor:"#fff",borderRadius:"64px",outline:"none",backgroundImage:`url('${l}settings_black_24dp.svg')`,backgroundRepeat:"no-repeat",backgroundPosition:"5px center"},{title:"Find Razor Source File - Settings",textContent:"Find Razor Source File"})},{settingsForm:r("div",{position:"fixed",bottom:"0",right:"8px",padding:"8px 12px",border:"#ccc",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",opacity:"0",transition:"ease-out all 0.2s",pointerEvents:"none"},null,[r("label",{margin:"0",padding:"0",fontFamily:"sans-serif",fontSize:"12px",color:"#111"},null,[{settingsOpenInVSCode:r("input",{margin:"0 8px 0 0",padding:"0",verticalAlign:"middle"},{type:"checkbox"})},r("span",{verticalAlign:"middle"},{textContent:"Open the .razor file of the clicked component in "}),r("img",{verticalAlign:"middle",width:"18px"},{src:l+"vscode.svg"}),r("span",{verticalAlign:"middle"},{textContent:" VSCode"}),])])}]);return n.appendChild(t),{...{overlay:t},...i}},v=t=>{const i=t===1?.3:.5,r=t===1?"0.8":"1.0";a(n.overlay,{borderColor:`rgba(0, 0, 0, ${i})`,boxShadow:`inset rgb(0, 0, 0, ${i}) 0px 0px 6px 4px`});n.sourceNameTip.style.opacity=r},rt=r=>{const f=r.code==="KeyF"&&r.ctrlKey&&r.shiftKey&&!r.metaKey&&!r.altKey,e=r.code==="Escape"&&!r.ctrlKey&&!r.shiftKey&&!r.metaKey&&!r.altKey;i===0&&f?(o(r),r.preventDefault(),i=1,a(n.overlay,{borderWidth:"50vh 50vw",display:"block"}),y(),setTimeout(()=>{(i===1||i===2)&&(n.overlay.style.opacity="1")},1),n.sourceNameTipProjectName.textContent="",n.sourceNameTipItemName.textContent="",u=null,t=null):(i===1||i===2)&&(e||f)&&(o(r),r.preventDefault(),i=f?0:i===2?1:0,v(1),n.sourceNameTip.style.display="none",n.overlay.style.borderWidth="50vh 50vw",y(),i===0&&(n.overlay.style.opacity="0",setTimeout(()=>{i===0&&(n.overlay.style.display="none")},200)))},ut=async n=>{i===1&&d(n)},k=n=>{if(y(),i===1){if(u!==null&&f!==null&&f!==h){i=2;v(2);const n=new Event("razorsource:lockin",{bubbles:!1,cancelable:!1});n.razorSourceName=f;s.dispatchEvent(n);c.openInVSCode&&(window.location.href=`vscode://file/${f.fullPath}`)}}else i===2&&(i=1,v(1),d(n))},ft=n=>{o(n),i===1&&k(n)},et=n=>{o(n),st()?ot():y()},ot=()=>Object.assign(n.settingsForm.style,{opacity:"1",bottom:"48px",pointerEvents:"unset"}),y=()=>Object.assign(n.settingsForm.style,{opacity:"0",bottom:"0",pointerEvents:"none"}),st=()=>n.settingsForm.style.opacity==="0",ht=t=>{o(t),c.openInVSCode=n.settingsOpenInVSCode.checked,pt()},d=async n=>{const t=ct(n);t.scopeHasChanged!==!1&&(f=await at(t.scope),g(t.scopeRect,f))},ct=i=>{n.overlay.style.visibility="hidden";const h=s.elementFromPoint(i.clientX,i.clientY);n.overlay.style.visibility="visible";let r=null;for(var e=h;e!==null;e=e.parentElement)if(r=lt(e),r!==null)break;let f=null;if(r===null){if(t!==null&&t.left<i.clientX&&i.clientX<t.right&&t.top<i.clientY&&i.clientY<t.bottom)return{scope:u,scopeRect:t,scopeHasChanged:!1}}else if(u!==null&&u!==r&&t!==null&&t.left<i.clientX&&i.clientX<t.right&&t.top<i.clientY&&i.clientY<t.bottom&&(f=w(r),f.left<t.left&&f.right>t.right&&f.top<t.top&&f.bottom>t.bottom))return{scope:u,scopeRect:t,scopeHasChanged:!1};const o=u!==r;return o&&(u=r,t=r==null?null:f!==null?f:w(r)),{scope:u,scopeRect:t,scopeHasChanged:o}},lt=n=>n.getAttributeNames().filter(n=>n.startsWith("b-"))[0]||null,at=async n=>{if(n===null)return null;let t=p[n]||null;if(t!==null)return t;const i=await fetch(`${l}RazorSourceMapFiles/${n}.txt`);if(i.ok){const u=await i.text(),t=u.replace(/[\r\n]*$/ig,"").split("|"),r={projectName:t[0],itemName:t[1],fullPath:t[2]};return p[n]=r,r}return p[n]=h,h},g=(t,i)=>{if(t===null||i===null||i===h){n.sourceNameTip.style.display="none";n.overlay.style.borderWidth="50vh 50vw";return}const r=n.overlay.getBoundingClientRect();a(n.overlay,{borderStyle:"solid",borderTopWidth:t.top+"px",borderLeftWidth:t.left+"px",borderBottomWidth:r.height-t.bottom+"px",borderRightWidth:r.width-t.right+"px"});n.sourceNameTipProjectName.textContent=i.projectName;n.sourceNameTipItemName.textContent=i.itemName;n.sourceNameTip.style.display="block"},w=n=>{const t={top:9999999,left:9999999,bottom:0,right:0};if(n!==null){const i=s.body.querySelectorAll(`*[${n}]`);i.forEach(n=>{const i=n.getBoundingClientRect();t.top=Math.min(t.top,i.top);t.left=Math.min(t.left,i.left);t.bottom=Math.max(t.bottom,i.bottom);t.right=Math.max(t.right,i.right)})}return t},vt=()=>{i!==0&&u!==null&&t!==null&&f!==null&&f!==h&&(t=w(u),g(t,f))},yt=()=>nt(),pt=()=>{const n=JSON.stringify(c);localStorage.setItem(b,n)},nt=()=>{const t=localStorage.getItem(b);Object.assign(c,JSON.parse(t||"{}"));n.settingsOpenInVSCode.checked=c.openInVSCode};